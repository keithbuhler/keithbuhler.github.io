import React, { useState, useEffect } from 'react';

// Main App component for the image slideshow
const App = () => {
  // Array of image URLs. These are the pages from your PDF, updated to your specified pattern.
  const images = [
    'https://www.keithbuhler.com/images/saa-dev-01.jpg', // Page 1
    'https://www.keithbuhler.com/images/saa-dev-02.jpg', // Page 2
    'https://www.keithbuhler.com/images/saa-dev-03.jpg', // Page 3
    'https://www.keithbuhler.com/images/saa-dev-04.jpg', // Page 4
    'https://www.keithbuhler.com/images/saa-dev-05.jpg', // Page 5
    'https://www.keithbuhler.com/images/saa-dev-06.jpg', // Page 6
    'https://www.keithbuhler.com/images/saa-dev-07.jpg', // Page 7
    'https://www.keithbuhler.com/images/saa-dev-08.jpg', // Page 8
    'https://www.keithbuhler.com/images/saa-dev-09.jpg', // Page 9
    'https://www.keithbuhler.com/images/saa-dev-10.jpg', // Page 10
    'https://www.keithbuhler.com/images/saa-dev-11.jpg', // Page 11
    'https://www.keithbuhler.com/images/saa-dev-12.jpg', // Page 12
    'https://www.keithbuhler.com/images/saa-dev-13.jpg', // Page 13
    'https://www.keithbuhler.com/images/saa-dev-14.jpg', // Page 14
    'https://www.keithbuhler.com/images/saa-dev-15.jpg', // Page 15
    'https://www.keithbuhler.com/images/saa-dev-16.jpg', // Page 16
    'https://www.keithbuhler.com/images/saa-dev-17.jpg', // Page 17
    'https://www.keithbuhler.com/images/saa-dev-18.jpg', // Page 18
    'https://www.keithbuhler.com/images/saa-dev-19.jpg', // Page 19
    'https://www.keithbuhler.com/images/saa-dev-20.jpg', // Page 20
    'https://www.keithbuhler.com/images/saa-dev-21.jpg', // Page 21
    'https://www.keithbuhler.com/images/saa-dev-22.jpg', // Page 22
    'https://www.keithbuhler.com/images/saa-dev-23.jpg', // Page 23
    'https://www.keithbuhler.com/images/saa-dev-24.jpg', // Page 24
    'https://www.keithbuhler.com/images/saa-dev-25.jpg', // Page 25
    'https://www.keithbuhler.com/images/saa-dev-26.jpg', // Page 26
    'https://www.keithbuhler.com/images/saa-dev-27.jpg', // Page 27
    'https://www.keithbuhler.com/images/saa-dev-28.jpg', // Page 28
    'https://www.keithbuhler.com/images/saa-dev-29.jpg', // Page 29
    'https://www.keithbuhler.com/images/saa-dev-30.jpg', // Page 30
    'https://www.keithbuhler.com/images/saa-dev-31.jpg', // Page 31
    'https://www.keithbuhler.com/images/saa-dev-32.jpg', // Page 32
  ];

  const [currentIndex, setCurrentIndex] = useState(0);
  const [message, setMessage] = useState(''); // State for displaying messages

  // Function to go to the previous slide
  const goToPrevious = () => {
    const isFirstSlide = currentIndex === 0;
    const newIndex = isFirstSlide ? images.length - 1 : currentIndex - 1;
    setCurrentIndex(newIndex);
    setMessage(''); // Clear message on navigation
  };

  // Function to go to the next slide
  const goToNext = () => {
    const isLastSlide = currentIndex === images.length - 1;
    const newIndex = isLastSlide ? 0 : currentIndex + 1;
    setCurrentIndex(newIndex);
    setMessage(''); // Clear message on navigation
  };

  // Function to handle keyboard navigation (arrow keys)
  useEffect(() => {
    const handleKeyDown = (event) => {
      if (event.key === 'ArrowLeft') {
        goToPrevious();
      } else if (event.key === 'ArrowRight') {
        goToNext();
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => {
      window.removeEventListener('keydown', handleKeyDown);
    };
  }, [currentIndex]); // Re-run effect if currentIndex changes

  // Function to handle touch gestures (swipe)
  useEffect(() => {
    let touchStartX = 0;
    let touchEndX = 0;

    const handleTouchStart = (e) => {
      touchStartX = e.touches[0].clientX;
    };

    const handleTouchMove = (e) => {
      touchEndX = e.touches[0].clientX;
    };

    const handleTouchEnd = () => {
      if (touchEndX < touchStartX - 50) { // Swiped left
        goToNext();
      }
      if (touchEndX > touchStartX + 50) { // Swiped right
        goToPrevious();
      }
      touchStartX = 0;
      touchEndX = 0;
    };

    const slideshowContainer = document.getElementById('slideshow-container');
    if (slideshowContainer) {
      slideshowContainer.addEventListener('touchstart', handleTouchStart);
      slideshowContainer.addEventListener('touchmove', handleTouchMove);
      slideshowContainer.addEventListener('touchend', handleTouchEnd);
    }

    return () => {
      if (slideshowContainer) {
        slideshowContainer.removeEventListener('touchstart', handleTouchStart);
        slideshowContainer.removeEventListener('touchmove', handleTouchMove);
        slideshowContainer.removeEventListener('touchend', handleTouchEnd);
      }
    };
  }, [currentIndex]); // Re-run effect if currentIndex changes

  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4 font-inter">
      <h1 className="text-4xl font-bold text-gray-800 mb-8 rounded-lg p-2">Interactive Slideshow</h1>

      <div
        id="slideshow-container"
        className="relative w-full max-w-4xl bg-white shadow-xl rounded-lg overflow-hidden flex flex-col items-center justify-center"
        style={{ aspectRatio: '4/3' }} // Maintain aspect ratio for common slide sizes
      >
        {/* Current image display */}
        {images.length > 0 ? (
          <img
            src={images[currentIndex]}
            alt={`Slide ${currentIndex + 1}`}
            className="w-full h-full object-contain rounded-lg"
            onError={(e) => {
              e.target.onerror = null; // Prevents infinite loop if fallback also fails
              e.target.src = `https://placehold.co/800x600/CCCCCC/000000?text=Image+Not+Found`;
              setMessage('Error loading image. Displaying placeholder.');
            }}
          />
        ) : (
          <div className="flex items-center justify-center w-full h-full text-gray-500 text-lg">
            No images to display. Please add image URLs.
          </div>
        )}

        {/* Navigation buttons */}
        <div className="absolute top-1/2 -translate-y-1/2 w-full flex justify-between px-4">
          <button
            onClick={goToPrevious}
            className="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-full shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-300 transform hover:scale-105"
            aria-label="Previous slide"
          >
            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <button
            onClick={goToNext}
            className="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-full shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-300 transform hover:scale-105"
            aria-label="Next slide"
          >
            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>

        {/* Slide indicators */}
        <div className="absolute bottom-4 flex space-x-2">
          {images.map((_, idx) => (
            <div
              key={idx}
              className={`h-3 w-3 rounded-full ${currentIndex === idx ? 'bg-blue-500' : 'bg-gray-300'} cursor-pointer transition-colors duration-300`}
              onClick={() => setCurrentIndex(idx)}
              aria-label={`Go to slide ${idx + 1}`}
            ></div>
          ))}
        </div>
      </div>

      {/* Message box for errors or info */}
      {message && (
        <div className="mt-4 p-3 bg-yellow-100 border border-yellow-400 text-yellow-700 rounded-lg shadow-md">
          {message}
        </div>
      )}

      <p className="mt-8 text-gray-600 text-center max-w-2xl">
        This slideshow supports navigation with the arrow keys and touch gestures (swiping).
        To use your PDF, please convert each page into an image (e.g., JPG or PNG) and update the `images` array in the code with the URLs of your converted images.
      </p>
    </div>
  );
};

export default App;
